// ---------------------------------------------------------------------------
// Imports

@import "compass/reset";
@import "base";

// standard colours
$highlight: #ff00ff;

// light theme colours
$background_grid_light: #ffffff;
$background_html_light: #ffffff;

// dark theme colours
$background_grid_dark: #222222;
$background_html_dark: #222222;

// transition points between media queries
$wide1: 1600px;
$wide2: 2400px;

/* -------------------------------------------------------------------------*/
/* Layout */

// yardsticks to measure viewport's actual size
.yardstick {
  background: #0000ff;
}
#yardstick-x {
  width: 100%;
  height: 0;
}
#yardstick-y {
  width: 0;
  height: 100%;
  float: left;
}

html {
  background-color: $background_html_light;
}

/* -------------------------------------------------------------------------*/
/* Modernizr variants */

html.flexbox.flow-x {
  overflow-x: scroll;

  .page .content {
    // row-major order
    .flow-x {
      display: -webkit-flex;
      -webkit-flex-flow: column wrap;
      -webkit-align-items: center;
      -webkit-justify-content: flex-start;
      -webkit-align-content: flex-start;
      display: flex;
      flex-flow: column wrap;
      align-items: center;
      justify-content: flex-start;
      align-content: flex-start;
      height: 100%;
    }
  }
}

// flow y, only option for no-flexbox browsers
html.flow-y, html.no-flexbox.flow-x {
  overflow-y: scroll;

  // column-major order
  .page .content {
    li {
      float: left;
    }
  }
}

// use CSS hover if no javascript
html.no-js {
  .header:hover, .footer:hover {
    width: 100%;
  }
}

/* -------------------------------------------------------------------------*/
/* Page */

.page {
  height: 100%;

  // header and footer are full-width by default.
  .header, .footer {
    clear: both;
    background-color: #ff0000;
    height: 2.0em;
    width: 2.0em;
    position: fixed;
    z-index: 2;
    overflow: hidden;
    
    p {
      float: left;
    }
  }

  .header {
    top: 0;
  }
  
  // footer not currently used
  .footer {
    bottom: 0;
  }

  .content {
    height: 100%;
    // everything in content is unhighlightable
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

    .flow-em > .cell {
      width: 20em;
      height: 20em;
    }

    // 1x1 is orientation-agnostic
    .flow-pc.flow-1 > .cell {
      width: 100%;
      height: 100%;
    }

    // portrait (*2)
    @media screen and (orientation:portrait) {
      // 2x4, default
      .flow-pc.flow-2 > .cell {
        width: (100% / 2);
        height: (100% / 4);
      }
      // 4x8
      .flow-pc.flow-4 > .cell {
        width: (100% / 4);
        height: (100% / 8);
      }
      // 8x16
      .flow-pc.flow-8 > .cell {
        width: (100% / 8);
        height: (100% / 16);
      }
    }

    // widescreen (*2)
    @media screen and (orientation:landscape) and (max-width: $wide1) {
      // 4x2, default
      .flow-pc.flow-2 > .cell {
        width: (100% / 4);
        height: (100% / 2);
      }
      // 8x4
      .flow-pc.flow-4 > .cell {
        width: (100% / 8);
        height: (100% / 4);
      }
      // 16x8
      .flow-pc.flow-8 > .cell {
        width: (100% / 16);
        height: (100% / 8);
      }
    }

    // widescreen (*3)
    @media screen and (orientation:landscape) and (min-width: ($wide1+1)) and (max-width: ($wide2)) {
      // 6x2, default
      .flow-pc.flow-2 > .cell {
        width: (100% / 6);
        height: (100% / 2);
      }
      // 12x4
      .flow-pc.flow-4 > .cell {
        width: (100% / 12);
        height: (100% / 4);
      }
      // 24x8
      .flow-pc.flow-8 > .cell {
        width: (100% / 24);
        height: (100% / 8);
      }
    }

    // widescreen (*4)
    @media screen and (orientation:landscape) and (min-width: ($wide2)) {
      // 8x2, default
      .flow-pc.flow-2 > .cell {
        width: (100% / 8);
        height: (100% / 2);
      }
      // 16x4
      .flow-pc.flow-4 > .cell {
        width: (100% / 16);
        height: (100% / 4);
      }
      // 32x8
      .flow-pc.flow-8 > .cell {
        width: (100% / 32);
        height: (100% / 8);
      }
    }

    .flow > .cell {
    /*
      border-style: solid; 
      border-color: $background_grid_light; 
      border-left-width: 1px;
      // add border to the top/left, but offset with margin to allow full percentage width/height
      border-top-width: 1px;
      margin-top: -1px;
      margin-left: -1px;
    */
      // centre
      text-align: center;
      // don't allow anything to bleed over the edge (to avoid superfluous scrollbars)
      overflow: hidden;

      p.imgmetric {
        line-height: 1.0em;
        position: absolute;
        z-index: 1;
        font-size: 0.6em;
        white-space: nowrap;
        display: none;
        
        .size, .perc {
          display: none;
        }

        &.super {
          background-color: #009900;        
          color: #BBFFBB;
        }
        
        &.sub {
          background-color: #990000;        
          color: #FFBBBB;
        }
      }

      // show metric if image is visible
      &.visible p.imgmetric {
        display: block;
      }
      // but not if it's in the process of reresing
      &.reresing p.imgmetric {
        display: none;
      }

      // cells can be selected, but the selection is shown (reflected) by an element within
      .selectreflector {
        // make borders appear inside to avoid pushing outside cell
/*
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
        border: 1px solid $background_html_light;
*/
      }

      &.selected .selectreflector {
        border-color: $highlight;
      }

      a { 
        // relative parent required for alignment of x-bound images and meta
        position: relative;
        // display block, height 100% required for aligning image metadata to base
        display: block;
        height: 100%;
        text-decoration: none;
        font-family: 'Gill Sans', 'Gill Sans MT', sans-serif;
        // font-family: 'Lucida Sans Unicode', 'Lucida Grande', sans-serif;
        // margin surfaces another issue
        margin: 0.5em;

        // landscape images
        > img.x-bound {
          position: relative;
          width: 100%;
          top: 50%;
          transform: translate(0, -50%);
          -ms-transform: translate(0, -50%);
          -webkit-transform: translate(0, -50%);
        }
      
        // portrait images
        > img.y-bound {
          height: 100%;
        }

        // metadata over bottom of image/cell
        .meta {
          // position absolute to stick to bottom
          display: block;
          position: absolute;
          bottom: 0;
          background-image: linear-gradient(rgba($background_html_light, 0), rgba($background_html_light, 0.8));
          color: #000000;
          height: 8em;
          text-align: left;
          left: 50%;
          margin-left: -50%;
          width: 100%;
          font-size: 0.8em;

          // don't show initially
          opacity: 0;
          // animation for disappearance
          transition: opacity 0.3s ease-out 0s;

          .base {
            position: absolute;
            bottom: 0;

            // all the spans (blocks) within metadata base
            span {
              margin: 1.0em;
              display: block;

              &.icons {
                height: 2.0em;
              }

              &.caption {
                font-weight: bold;
              }

              &.byline {
                margin-top: .5em;
              }
            }
          }

        }

        &:hover .meta {
          // show on hover
          opacity: 1;
          // animation for appearance
          transition: opacity 0.3s ease-in 0s;
        }

        // title over directories
        .title {
          opacity:0.7;
          filter:alpha(opacity=70); /* For IE8 and earlier */
          height: 0;
          line-height: 0;
          top: -4.0em;
          position: relative;
          width: 100px;
          background-color: $background_html_dark;
          color: #ffffff;
          margin: 0 2.4% 0 2.7%;
          padding: 0.5em;
        }
        
        // directories with preview images
        div.directory {
          background: url('/chrome/images/fullres/folder_back_light.png') no-repeat left top;
          background-size: 100% 100%;
          width: 100%;
          height: 100%;
          display: block;
          text-align: right;
          position: relative;
  
          .overlay {
            width: 100%;
            height: 100%;
            display: inline-block;
            // absolute position within relative container to do overlay with no effective height
            position: absolute;
            top: 0;
            z-index: 1;
          }
  
          .preview {
            width: 42.7%;
            height: 38%;
            position: relative;
            margin-right: 3%;
          }
          
          /**
           * disabled: currently aligning right
          .preview-1, .preview-3 {
            // used for text-align: left in parent
            margin-left: 6%;
          }
           */

          .preview-2, .preview-4 {
            // used for text-align: right in parent
            margin-right: 6%;
          }

          .preview-1, .preview-2  {
            // have to use 'top' because 'margin-top' percentage calculated on element width!
            top: 13%;
          }
  
          .preview-3, .preview-4  {
            top: 16.4%;
          }

        }
      }

      // use CSS trick to make directories maintain aspect ratio, in combination with vertical centring
      // http://ansciath.tumblr.com/post/7347495869/css-aspect-ratio
      div.dummy1 {
        height: 50%;
      }

      a.directory-container {
        display: inline-block;
        width: 100%;
        text-align: right;
        margin-top: -37.5%; // 4:3 / 2
        // margin-top: -28.125%; // 16:9 / 2
        
        .dummy2 {
          padding-top: 75%; // 4:3
          // padding-top: 56.25%; // 16:9
        }
        
        div.directory {
          position: absolute;
          top: 0;
          right: 0;
          bottom: 0;
          left: 0;
        }

      }
      
    }
  }
}

/* -------------------------------------------------------------------------*/
/* Theme variants */

html.theme-dark {
  background-color: $background_html_dark;

  .page .content .flow > .cell {
    border-color: $background_grid_dark; 

    &:not(.selected) .selectreflector {
      border-color: $background_html_dark;
    }

    a .meta {
      background-image: linear-gradient(rgba($background_html_dark, 0), rgba($background_html_dark, 0.8));
      color: #ffffff;
    }
    
    .directory {
      background-image: url('/chrome/images/fullres/folder_back_dark.png');
    }
  }
}

/* -------------------------------------------------------------------------*/
/* Test suite */

#qunit {
  position: absolute;
  // really not part of the typical page stack, well above
  z-index: 999;
}

